import{c as W,j as e,r,s as X}from"./auth-BQqFf9p-.js";import{B as E,P as R,T as w,a as k,D as $,b as C,c as H}from"./dice-kvIfya4H.js";import{u as O,l as q,a as f}from"./db-DCl0--BQ.js";W.createRoot(document.getElementById("root")).render(e.jsx(r.StrictMode,{children:e.jsx(z,{})}));function z(){const[u,S]=r.useState(new E),[h,P]=r.useState("X"),[g,y]=r.useState(5),[j,x]=r.useState("ROLLING"),[I,b]=r.useState(1),[v,G]=r.useState(!1),[F,N]=r.useState(!1),[J,L]=r.useState(""),[p,M]=r.useState(""),[T,V]=r.useState({}),[n,Y]=r.useState(null);r.useEffect(()=>{X()},[]),r.useEffect(()=>{const a=new E;a.initi(3,3),S(a),L(localStorage.getItem("userId"));const i=new URLSearchParams(window.location.search).get("gameCode");i&&M(i),O(i,a),q(i,t=>{if(console.log("Game data updated:",t),t){const c={};Object.keys(t.players).forEach(o=>{const m=t.players[o];c[o]=new C({displayName:m.displayName,symbol:m.symbol,isTurn:m.isTurn,pointsToInvest:m.pointsToInvest,isGambling:m.isGambling,gambleAmount:m.gambleAmount,playerId:m.playerId})}),V(c),console.log("Current Players:",c);const l=Object.values(c).find(o=>o.playerId===localStorage.getItem("userId"));console.log("Current Player:",l),l&&Y(new C({displayName:l.displayName,symbol:l.symbol,isTurn:l.isTurn,pointsToInvest:l.pointsToInvest,isGambling:l.isGambling,gambleAmount:l.gambleAmount,playerId:l.playerId}));const d=Object.values(c).find(o=>o.isTurn);if(d&&(P(d.symbol),y(d.pointsToInvest),G(d.isGambling),b(d.gambleAmount)),t.board){const o=new E;o.grid=t.board.grid.map(m=>m.map(B=>{const A=new H;return A.claimedBy=B.claimedBy,A.investedPoints=B.investedPoints,A})),o.winner=t.board.winner,S(o)}}else window.location.href=window.location.href.replace("Online/?gameCode="+i.toString(),"")})},[]);const D=(a,s,i)=>{const t=u.clone();if(j===w.INVESTING){if(console.log("Handling tile action at",a,"by player",s,"new turn will be",i),g<=0)return;t.grid[a.y][a.x].investPoints(s,1),y(g-1);const c={...T};c[n.playerId].pointsToInvest=g-1,f(p,c),g-1<=0&&setTimeout(()=>{P(i),x(w.ROLLING);const l={...T};l[n.playerId].isTurn=!1;const d=Object.values(l).find(o=>o.playerId!==n.playerId);d&&(l[d.playerId].isTurn=!0),f(p,l)},500)}t.checkWin(),O(p,t),S(t)},U=a=>{if(console.log("Rolled:",a,v,I),N(!1),v){if(G(!1),a===I){y(a*2),x("INVESTING");const s={...T};s[n.playerId].isGambling=!1,s[n.playerId].pointsToInvest=a*2,s[n.playerId].gambleAmount=1,f(p,s)}else{y(0),b(1),P(h==="X"?"O":"X");const s={...T};s[n.playerId].isGambling=!1,s[n.playerId].pointsToInvest=0,s[n.playerId].gambleAmount=1,s[n.playerId].isTurn=!1;const i=Object.values(s).find(t=>t.playerId!==n.playerId);i&&(s[i.playerId].isTurn=!0),f(p,s);return}b(1)}else{b(1),y(a),x("INVESTING");const s={...T};s[n.playerId].isGambling=!1,s[n.playerId].pointsToInvest=a,s[n.playerId].gambleAmount=1,f(p,s)}N(!1)};return e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"title",children:"Tic Tac Gamble"}),e.jsxs("div",{className:`App ${n?.isTurn?j:"INVESTING"}`,children:[u.winner!=R.EMPTY?e.jsxs("h2",{children:[" Winner: ",u.winner," "]}):e.jsxs("h2",{children:["Current Turn: ",e.jsx("span",{className:`${h}-indicator`,children:h})]}),u.winner!=R.EMPTY?e.jsx(e.Fragment,{}):j===w.INVESTING||!n?.isTurn?e.jsxs(e.Fragment,{children:[u.winner==R.EMPTY&&e.jsxs("label",{htmlFor:"",className:"points-to-invest",children:["Points To Invest: ",g]}),e.jsx(k,{board:u,turn:h,onTileAction:D,canPlay:n?.isTurn||!1})]}):j===w.ROLLING?e.jsxs(e.Fragment,{children:[e.jsx($,{onRoll:U,startRolling:()=>N(!0)}),v?e.jsx("div",{className:"gamble-info",children:e.jsxs("h2",{children:["You need a ",I,"!"]})}):F?e.jsx(e.Fragment,{}):e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"number",name:"gamble",id:"gamble-amount",className:"gamble-input",min:1,max:6,value:I,onChange:a=>{b(Math.min(6,Math.max(1,parseInt(a.target.value))))}}),I?e.jsx("button",{className:"gamble-button",onClick:()=>{G(!0)},children:"Gamble"}):e.jsx(e.Fragment,{})," "]})]}):e.jsx("div",{children:"Stealing Stage - Not Implemented"})]})]})}
